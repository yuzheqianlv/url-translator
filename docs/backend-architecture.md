# URLç¿»è¯‘å·¥å…·åç«¯æ¶æ„è®¾è®¡

## ğŸ§ é¡¹ç›®æ¶æ„æ¦‚è§ˆ

æœ¬æ–‡æ¡£æè¿°äº†URLç¿»è¯‘å·¥å…·åç«¯æœåŠ¡çš„æ¶æ„è®¾è®¡å’Œå®ç°è§„åˆ’ã€‚

## ğŸ“¦ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶
- **è¯­è¨€**: Rust 2021 Edition
- **Webæ¡†æ¶**: Axum 0.7.x (é«˜æ€§èƒ½ã€ç±»å‹å®‰å…¨)
- **æ•°æ®åº“ORM**: SQLx + SeaORM (å¼‚æ­¥ã€ç¼–è¯‘æ—¶æ£€æŸ¥)
- **ç¼“å­˜**: Redis + fred (é«˜æ€§èƒ½ Redis å®¢æˆ·ç«¯)
- **æœç´¢**: MeiliSearch + meilisearch-sdk

### æ”¯æŒåº“
- **åºåˆ—åŒ–**: Serde + serde_json
- **å¼‚æ­¥è¿è¡Œæ—¶**: Tokio 1.x
- **HTTPå®¢æˆ·ç«¯**: Reqwest 0.11.x
- **æ•°æ®éªŒè¯**: Validator + garde
- **æ—¥å¿—**: tracing + tracing-subscriber
- **é…ç½®**: config + dotenvy
- **é”™è¯¯å¤„ç†**: anyhow + thiserror
- **æµ‹è¯•**: rstest + mockall

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ Cargo.toml              # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ Dockerfile             # Dockeræ„å»ºé…ç½®
â”œâ”€â”€ .env.example           # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs            # åº”ç”¨å…¥å£ç‚¹
â”‚   â”œâ”€â”€ lib.rs             # åº“æ ¹æ¨¡å—
â”‚   â”œâ”€â”€ config/            # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ app.rs         # åº”ç”¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ database.rs    # æ•°æ®åº“é…ç½®
â”‚   â”‚   â””â”€â”€ redis.rs       # Redisé…ç½®
â”‚   â”œâ”€â”€ handlers/          # HTTPè¯·æ±‚å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ auth.rs        # è®¤è¯ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ translation.rs # ç¿»è¯‘ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ search.rs      # æœç´¢ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ history.rs     # å†å²è®°å½•
â”‚   â”‚   â”œâ”€â”€ config.rs      # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ health.rs      # å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ translation_service.rs
â”‚   â”‚   â”œâ”€â”€ search_service.rs
â”‚   â”‚   â”œâ”€â”€ user_service.rs
â”‚   â”‚   â”œâ”€â”€ cache_service.rs
â”‚   â”‚   â””â”€â”€ notification_service.rs
â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ user.rs        # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ translation.rs # ç¿»è¯‘æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ project.rs     # é¡¹ç›®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ search.rs      # æœç´¢æ¨¡å‹
â”‚   â”œâ”€â”€ dto/               # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ auth.rs        # è®¤è¯DTO
â”‚   â”‚   â”œâ”€â”€ translation.rs # ç¿»è¯‘DTO
â”‚   â”‚   â”œâ”€â”€ search.rs      # æœç´¢DTO
â”‚   â”‚   â””â”€â”€ common.rs      # é€šç”¨DTO
â”‚   â”œâ”€â”€ database/          # æ•°æ®åº“è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ connection.rs  # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ migrations/    # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â””â”€â”€ repositories/  # æ•°æ®ä»“åº“
â”‚   â”‚       â”œâ”€â”€ mod.rs
â”‚   â”‚       â”œâ”€â”€ user_repository.rs
â”‚   â”‚       â”œâ”€â”€ translation_repository.rs
â”‚   â”‚       â””â”€â”€ project_repository.rs
â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ auth.rs        # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ cors.rs        # CORSä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ logging.rs     # æ—¥å¿—ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ rate_limit.rs  # é™æµä¸­é—´ä»¶
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ validation.rs  # æ•°æ®éªŒè¯
â”‚   â”‚   â”œâ”€â”€ crypto.rs      # å¯†ç å­¦å·¥å…·
â”‚   â”‚   â”œâ”€â”€ jwt.rs         # JWTå·¥å…·
â”‚   â”‚   â””â”€â”€ file.rs        # æ–‡ä»¶å·¥å…·
â”‚   â””â”€â”€ errors/            # é”™è¯¯å¤„ç†
â”‚       â”œâ”€â”€ mod.rs
â”‚       â”œâ”€â”€ app_error.rs   # åº”ç”¨é”™è¯¯
â”‚       â””â”€â”€ api_error.rs   # APIé”™è¯¯
â”œâ”€â”€ tests/                 # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ api/
â””â”€â”€ migrations/            # æ•°æ®åº“è¿ç§»æ–‡ä»¶
    â””â”€â”€ *.sql
```

## ğŸ”„ æ¶æ„æ¨¡å¼

### åˆ†å±‚æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   APIå±‚ (Handlers)                  â”‚
â”‚  - HTTPè·¯ç”±å’Œè¯·æ±‚å¤„ç†                            â”‚
â”‚  - è¯·æ±‚éªŒè¯å’Œå“åº”åºåˆ—åŒ–                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 ä¸šåŠ¡æœåŠ¡å±‚ (Services)                â”‚
â”‚  - ä¸šåŠ¡é€»è¾‘å®ç°                                â”‚
â”‚  - å¤–éƒ¨APIè°ƒç”¨ (Jina, DeepLX)                   â”‚
â”‚  - ç¼“å­˜ç­–ç•¥å’Œæœç´¢é›†æˆ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                æ•°æ®è®¿é—®å±‚ (Repositories)               â”‚
â”‚  - æ•°æ®åº“CRUDæ“ä½œ                             â”‚
â”‚  - æŸ¥è¯¢æ„å»ºå’Œç»“æœæ˜ å°„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 æ•°æ®å­˜å‚¨å±‚ (Storage)                 â”‚
â”‚  PostgreSQL    Redis Cache    MeiliSearch         â”‚
â”‚  (ä¸»æ•°æ®åº“)     (ç¼“å­˜)        (æœç´¢å¼•æ“)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘
1. **HTTPè¯·æ±‚** â†’ **ä¸­é—´ä»¶** (è®¤è¯/é™æµ/æ—¥å¿—) â†’ **Handler**
2. **Handler** â†’ **æ•°æ®éªŒè¯** â†’ **Service**
3. **Service** â†’ **Repository/Cache/Search** â†’ **æ•°æ®åº“**
4. **ç»“æœ** â† **DTOè½¬æ¢** â† **å“åº”åºåˆ—åŒ–** â† **Handler**

## ğŸ”Œ API è®¾è®¡

### RESTful API ç«¯ç‚¹

#### è®¤è¯ç«¯ç‚¹
```
POST   /api/v1/auth/register     # ç”¨æˆ·æ³¨å†Œ
POST   /api/v1/auth/login        # ç”¨æˆ·ç™»å½•
POST   /api/v1/auth/logout       # ç”¨æˆ·ç™»å‡º
POST   /api/v1/auth/refresh      # åˆ·æ–°Token
GET    /api/v1/auth/profile      # è·å–ç”¨æˆ·ä¿¡æ¯
```

#### ç¿»è¯‘ç«¯ç‚¹
```
POST   /api/v1/translations           # å•é¡µç¿»è¯‘
POST   /api/v1/translations/batch     # æ‰¹é‡ç¿»è¯‘
GET    /api/v1/translations/{id}      # è·å–ç¿»è¯‘ç»“æœ
GET    /api/v1/translations           # ç¿»è¯‘åˆ—è¡¨
DELETE /api/v1/translations/{id}      # åˆ é™¤ç¿»è¯‘
GET    /api/v1/translations/{id}/download # ä¸‹è½½æ–‡ä»¶
```

#### é¡¹ç›®ç®¡ç†ç«¯ç‚¹
```
POST   /api/v1/projects              # åˆ›å»ºé¡¹ç›®
GET    /api/v1/projects              # é¡¹ç›®åˆ—è¡¨
GET    /api/v1/projects/{id}         # é¡¹ç›®è¯¦æƒ…
PUT    /api/v1/projects/{id}         # æ›´æ–°é¡¹ç›®
DELETE /api/v1/projects/{id}         # åˆ é™¤é¡¹ç›®
GET    /api/v1/projects/{id}/stats   # é¡¹ç›®ç»Ÿè®¡
```

#### æœç´¢ç«¯ç‚¹
```
GET    /api/v1/search               # å…¨æ–‡æœç´¢
GET    /api/v1/search/suggestions   # æœç´¢å»ºè®®
GET    /api/v1/search/history       # æœç´¢å†å²
DELETE /api/v1/search/history/{id}  # åˆ é™¤æœç´¢å†å²
```

#### é…ç½®ç«¯ç‚¹
```
GET    /api/v1/config               # è·å–ç”¨æˆ·é…ç½®
PUT    /api/v1/config               # æ›´æ–°ç”¨æˆ·é…ç½®
GET    /api/v1/config/system        # ç³»ç»Ÿé…ç½® (ç®¡ç†å‘˜)
```

#### ç³»ç»Ÿç«¯ç‚¹
```
GET    /api/v1/health               # å¥åº·æ£€æŸ¥
GET    /api/v1/metrics              # ç³»ç»ŸæŒ‡æ ‡
GET    /api/v1/stats                # ä½¿ç”¨ç»Ÿè®¡
```

### å“åº”æ ¼å¼
```json
{
  "success": true,
  "data": {
    // å®é™…æ•°æ®
  },
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": "2025-07-10T12:00:00Z",
  "request_id": "uuid"
}
```

### é”™è¯¯å“åº”
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "å‚æ•°éªŒè¯å¤±è´¥",
    "details": {
      "field": "url",
      "reason": "Invalid URL format"
    }
  },
  "timestamp": "2025-07-10T12:00:00Z",
  "request_id": "uuid"
}
```

## ğŸ” å®‰å…¨è®¾è®¡

### è®¤è¯å’Œæˆæƒ
- **JWT Token**: æ— çŠ¶æ€è®¤è¯
- **å¯†ç åŠ å¯†**: Argon2id å“ˆå¸Œ
- **æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶

### æ•°æ®å®‰å…¨
- **è¾“å…¥éªŒè¯**: ä¸¥æ ¼çš„å‚æ•°æ ¡éªŒ
- **SQLæ³¨å…¥é˜²æŠ¤**: å‚æ•°åŒ–æŸ¥è¯¢
- **XSSé˜²æŠ¤**: è¾“å‡ºç¼–ç å’Œæ¸…ç†
- **CSRFé˜²æŠ¤**: CSRF Token

### ç½‘ç»œå®‰å…¨
- **HTTPS**: å¼ºåˆ¶åŠ å¯†ä¼ è¾“
- **CORS**: é…ç½®å…è®¸çš„æº
- **é™æµ**: APIè°ƒç”¨é¢‘ç‡é™åˆ¶

## ğŸ”„ ç¼“å­˜ç­–ç•¥

### Redis ç¼“å­˜è®¾è®¡

#### ç¼“å­˜åˆ†ç±»
1. **ç¿»è¯‘ç»“æœç¼“å­˜** (TTL: 24å°æ—¶)
   - Key: `translation:{url_hash}`
   - Value: JSON æ ¼å¼çš„ç¿»è¯‘ç»“æœ

2. **ç”¨æˆ·ä¼šè¯ç¼“å­˜** (TTL: 30åˆ†é’Ÿ)
   - Key: `session:{user_id}`
   - Value: ç”¨æˆ·ä¼šè¯ä¿¡æ¯

3. **APIé™æµç¼“å­˜** (TTL: 1å°æ—¶)
   - Key: `rate_limit:{user_id}:{endpoint}`
   - Value: è¯·æ±‚è®¡æ•°å™¨

4. **æœç´¢ç»“æœç¼“å­˜** (TTL: 10åˆ†é’Ÿ)
   - Key: `search:{query_hash}`
   - Value: æœç´¢ç»“æœåˆ—è¡¨

### ç¼“å­˜ç­–ç•¥
- **Cache-Aside**: åº”ç”¨ä¸»åŠ¨ç®¡ç†ç¼“å­˜
- **ç¼“å­˜ç©¿é€é˜²æŠ¤**: å¸ƒéš†è¿‡æ»¤å™¨
- **ç¼“å­˜é›ªå´©é˜²æŠ¤**: ç†”æ–­å™¨æ¨¡å¼

## ğŸ” æœç´¢é›†æˆ

### MeiliSearch ç´¢å¼•è®¾è®¡

#### ç´¢å¼•ç»“æ„
```rust
// ç¿»è¯‘å†…å®¹ç´¢å¼•
struct TranslationDocument {
    id: String,
    url: String,
    title: String,
    original_content: String,
    translated_content: String,
    source_lang: String,
    target_lang: String,
    created_at: i64,
    user_id: String,
    tags: Vec<String>,
}
```

#### æœç´¢é…ç½®
- **å¯æœç´¢å­—æ®µ**: title, original_content, translated_content
- **è¿‡æ»¤å­—æ®µ**: source_lang, target_lang, user_id, created_at
- **æ’åºå­—æ®µ**: created_at, title
- **é«˜äº®å­—æ®µ**: title, content ç‰‡æ®µ

### æœç´¢åŠŸèƒ½
- **å…¨æ–‡æœç´¢**: åœ¨æ‰€æœ‰ç¿»è¯‘å†…å®¹ä¸­æœç´¢
- **é«˜çº§ç­›é€‰**: æŒ‰è¯­è¨€ã€æ—¥æœŸç­‰è¿‡æ»¤
- **è”æƒ³æœç´¢**: è‡ªåŠ¨å®Œæˆå’Œå»ºè®®
- **è¯­ä¹‰æœç´¢**: åŸºäºå†…å®¹ç›¸ä¼¼æ€§

## ğŸ“‹ æ•°æ®åº“è®¾è®¡

### ä¸»è¦å®ä½“å…³ç³»
```
Users (1) â†â†’ (N) UserConfigs
Users (1) â†â†’ (N) TranslationProjects
TranslationProjects (1) â†â†’ (N) TranslationRecords
TranslationRecords (1) â†â†’ (1) TranslationContents
Users (1) â†â†’ (N) SearchHistory
```

### æ•°æ®åº“ä¼˜åŒ–
- **ç´¢å¼•ä¼˜åŒ–**: å¸¸ç”¨æŸ¥è¯¢å­—æ®µåŠ ç´¢å¼•
- **åˆ†åŒºè¡¨**: æŒ‰æ—¶é—´åˆ†åŒºå¤§è¡¨
- **è¿æ¥æ± **: ä¼˜åŒ–æ•°æ®åº“è¿æ¥ç®¡ç†
- **è¯»å†™åˆ†ç¦»**: æœªæ¥æ”¯æŒä¸»ä»å¤åˆ¶

## ğŸ› ï¸ å¼€å‘å·¥å…·é“¾

### æ„å»ºå’Œéƒ¨ç½²
- **æœ¬åœ°å¼€å‘**: `cargo watch -x run`
- **æ•°æ®åº“è¿ç§»**: `sqlx migrate run`
- **å®¹å™¨åŒ–**: Docker å¤šé˜¶æ®µæ„å»º
- **å¥åº·æ£€æŸ¥**: å†…ç½®çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹

### ä»£ç è´¨é‡
- **æ ¼å¼åŒ–**: `cargo fmt`
- **é™æ€åˆ†æ**: `cargo clippy`
- **æµ‹è¯•**: `cargo test`
- **æ€§èƒ½æµ‹è¯•**: criterion.rs

### ç‰ˆæœ¬æ§åˆ¶
- **Git Hooks**: é¢„æäº¤æ£€æŸ¥
- **CI/CD**: GitHub Actions
- **ä¾èµ–ç®¡ç†**: Dependabot

## ğŸ“ˆ æ€§èƒ½ç›®æ ‡

### å“åº”æ—¶é—´
- **APIå“åº”**: < 100ms (P95)
- **æ•°æ®åº“æŸ¥è¯¢**: < 50ms (P95)
- **ç¼“å­˜å‘½ä¸­**: > 80%
- **æœç´¢å“åº”**: < 200ms (P95)

### ååé‡
- **å¹¶å‘è¯·æ±‚**: 1000+ RPS
- **æ•°æ®åº“è¿æ¥**: 100+ å¹¶å‘
- **ç¼“å­˜æ“ä½œ**: 10000+ OPS

### èµ„æºä½¿ç”¨
- **å†…å­˜ä½¿ç”¨**: < 512MB
- **CPUä½¿ç”¨**: < 2 cores
- **ç£ç›˜I/O**: ä¼˜åŒ–æ‰¹é‡æ“ä½œ

## ğŸ“ å®æ–½è®¡åˆ’

### é˜¶æ®µ1: åŸºç¡€æ¡†æ¶ (1-2å‘¨)
- [x] é¡¹ç›®æ¶æ„è®¾è®¡
- [ ] åŸºæœ¬æ¡†æ¶æ­å»º (Axum + SQLx)
- [ ] æ•°æ®åº“è¿æ¥å’Œè¿ç§»
- [ ] åŸºç¡€ä¸­é—´ä»¶ (æ—¥å¿—/CORS/é”™è¯¯å¤„ç†)
- [ ] å¥åº·æ£€æŸ¥ç«¯ç‚¹

### é˜¶æ®µ2: æ ¸å¿ƒåŠŸèƒ½ (2-3å‘¨)
- [ ] ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- [ ] ç¿»è¯‘APIå°è£…
- [ ] æ•°æ®åº“æ¨¡å‹å’Œä»“åº“
- [ ] Redisç¼“å­˜é›†æˆ
- [ ] åŸºç¡€CRUDæ“ä½œ

### é˜¶æ®µ3: é«˜çº§åŠŸèƒ½ (2-3å‘¨)
- [ ] MeiliSearché›†æˆ
- [ ] æ‰¹é‡ç¿»è¯‘æ”¯æŒ
- [ ] æœç´¢åŠŸèƒ½å®Œå–„
- [ ] é™æµå’Œé˜²æŠ¤æœºåˆ¶
- [ ] æ–‡ä»¶ä¸Šä¼ ä¸‹è½½

### é˜¶æ®µ4: ä¼˜åŒ–å’Œéƒ¨ç½² (1-2å‘¨)
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å®‰å…¨å¼ºåŒ–
- [ ] ç›‘æ§å’Œæ—¥å¿—
- [ ] DockeråŒ–å’Œéƒ¨ç½²
- [ ] æ–‡æ¡£å’Œæµ‹è¯•

è¿™ä¸ªæ¶æ„è®¾è®¡ä¸ºé¡¹ç›®æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ï¼Œæ”¯æŒé«˜å¹¶å‘ã€é«˜æ€§èƒ½çš„ç¿»è¯‘æœåŠ¡ã€‚é€šè¿‡åˆ†å±‚æ¶æ„å’Œå¾®æœåŠ¡è®¾è®¡ï¼Œç³»ç»Ÿå…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚